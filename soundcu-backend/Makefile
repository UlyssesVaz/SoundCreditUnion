.PHONY: help setup start stop restart logs shell db-init db-reset test clean

help:
	@echo "Sound CU Co-Pilot Backend - Available Commands"
	@echo "==============================================="
	@echo ""
	@echo "  make setup      - Initial setup (copy .env, start services, init DB)"
	@echo "  make start      - Start all services"
	@echo "  make stop       - Stop all services"
	@echo "  make restart    - Restart all services"
	@echo "  make logs       - View backend logs"
	@echo "  make shell      - Open backend shell"
	@echo "  make db-init    - Initialize database with seed data"
	@echo "  make db-reset   - Reset database (WARNING: deletes all data)"
	@echo "  make test       - Run API tests"
	@echo "  make clean      - Stop services and remove volumes"
	@echo ""

setup:
	@./setup.sh

start:
	@echo "ğŸš€ Starting services..."
	@docker-compose up -d
	@echo "âœ… Services started"
	@echo "   API: http://localhost:8000"
	@echo "   Docs: http://localhost:8000/v1/docs"

stop:
	@echo "ğŸ›‘ Stopping services..."
	@docker-compose down
	@echo "âœ… Services stopped"

restart:
	@echo "ğŸ”„ Restarting services..."
	@docker-compose restart
	@echo "âœ… Services restarted"

logs:
	@docker-compose logs -f backend

shell:
	@docker-compose exec backend /bin/bash

db-init:
	@echo "ğŸŒ± Initializing database..."
	@docker-compose exec backend python scripts/init_db.py
	@echo "âœ… Database initialized"

db-reset:
	@echo "âš ï¸  WARNING: This will delete all data!"
	@read -p "Are you sure? (y/n) " -n 1 -r; \
	echo; \
	if [[ $$REPLY =~ ^[Yy]$$ ]]; then \
		echo "ğŸ—‘ï¸  Resetting database..."; \
		docker-compose down -v; \
		docker-compose up -d; \
		sleep 10; \
		docker-compose exec backend python scripts/init_db.py; \
		echo "âœ… Database reset complete"; \
	fi

test:
	@./test_api.sh

clean:
	@echo "ğŸ§¹ Cleaning up..."
	@docker-compose down -v
	@echo "âœ… Cleanup complete"
